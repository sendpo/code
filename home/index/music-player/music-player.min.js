window.addEventListener("load",function(){const e=document.getElementById("audio-player"),t=document.getElementById("player-container"),n="https://www.hhlqilongzhu.cn/api/wangyi_hot_review.php";let a=!1,o=null,i=!1;function r(t){const n=Math.floor(t/60),a=Math.floor(t%60);return`${n}:${a<10?"0"+a:a}`}function c(){if(!e.duration||a)return;const t=e.currentTime/e.duration*100,n=document.querySelector(".progress-played"),o=document.querySelector(".progress-handle"),i=document.querySelector(".current-time-text"),c=document.querySelector(".total-time-text");n.style.width=`${t}%`,o.style.left=`${t}%`,i.textContent=r(e.currentTime),c.textContent=r(e.duration),t>0&&(o.style.display="block")}function s(){const t=document.querySelector(".progress-container"),n=document.querySelector(".progress-played"),o=document.querySelector(".progress-handle");function i(i){const r=t.getBoundingClientRect();let c=(i.clientX-r.left)/r.width;c=Math.max(0,Math.min(1,c)),n.style.width=`${100*c}%`,o.style.left=`${100*c}%`,e.currentTime=c*e.duration,document.querySelector(".current-time-text").textContent=r(e.currentTime)}t.addEventListener("mousedown",t=>{a=!0,o.style.cursor="grabbing",i(t),e.paused&&o&&o.classList.remove("playing")}),document.addEventListener("mousemove",t=>{a&&i(t)}),document.addEventListener("mouseup",()=>{a&&(a=!1,o.style.cursor="grab",e.paused||o&&o.classList.add("playing"),e.paused||e.play())})}function d(e){o&&(e?o.classList.add("playing"):o.classList.remove("playing"))}async function l(){try{t.innerHTML=`<div class="player-loading"><i class="fas fa-spinner fa-spin"></i> 正在切换歌曲...</div>`;const a=await fetch(n),l=await a.json();if(200!==l.code||!l.url)throw new Error("歌曲数据异常");t.innerHTML=`<div class="player-content"><img src="${l.img}" alt="${l.song} 封面" class="player-cover" id="current-cover"><div class="player-info"><div class="player-song">${l.song}</div><div class="player-singer">${l.singer}</div><div class="player-control-wrapper"><div class="player-controls"><button id="play-btn" class="player-btn"><i class="fas fa-play"></i></button><button id="pause-btn" class="player-btn" style="display:none"><i class="fas fa-pause"></i></button><button id="next-btn" class="player-btn"><i class="fas fa-step-forward"></i></button></div></div><div class="progress-container"><div class="progress-played"></div><div class="progress-handle"></div></div><div class="progress-time"><span class="current-time-text">0:00</span><span class="total-time-text">0:00</span></div><a href="${l.link}" target="_blank" class="player-link"><i class="fab fa-napster"></i> 前往网易云音乐查看</a></div></div>`,o=document.getElementById("current-cover"),e.src=l.url,i&&e.play().then(()=>{document.getElementById("play-btn").style.display="none",document.getElementById("pause-btn").style.display="flex",d(!0)}).catch(()=>{}),s(),document.getElementById("play-btn").addEventListener("click",()=>{i=!0,e.play(),document.getElementById("play-btn").style.display="none",document.getElementById("pause-btn").style.display="flex",d(!0)}),document.getElementById("pause-btn").addEventListener("click",()=>{e.pause(),document.getElementById("pause-btn").style.display="none",document.getElementById("play-btn").style.display="flex",d(!1)}),document.getElementById("next-btn").addEventListener("click",()=>{o&&o.classList.remove("playing"),l()}),e.addEventListener("timeupdate",c),e.addEventListener("loadedmetadata",()=>{document.querySelector(".total-time-text").textContent=r(e.duration)}),e.addEventListener("ended",()=>{d(!1),l()}),e.addEventListener("pause",()=>d(!1)),e.addEventListener("play",()=>d(!0))}catch(e){t.innerHTML=`<div class="player-loading" style="color:var(--accent-color);"><i class="fas fa-exclamation-circle"></i> 歌曲加载失败：${e.message}</div>`,console.error("音乐获取失败：",e)}}l()});
