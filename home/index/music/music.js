const audioPlayer=document.getElementById('audio-player');const playerContainer=document.getElementById('player-container');const apiUrl='https://www.hhlqilongzhu.cn/api/wangyi_hot_review.php';let isDragging=false;function formatTime(seconds){const min=Math.floor(seconds/60);const sec=Math.floor(seconds%60);return`${min}:${sec<10?'0'+sec:sec}`}function updateProgress(){if(!audioPlayer.duration||isDragging)return;const progressPercent=(audioPlayer.currentTime/audioPlayer.duration)*100;const progressPlayed=document.querySelector('.progress-played');const progressHandle=document.querySelector('.progress-handle');const currentTimeEl=document.querySelector('.current-time-text');const totalTimeEl=document.querySelector('.total-time-text');progressPlayed.style.width=`${progressPercent}%`;progressHandle.style.left=`${progressPercent}%`;currentTimeEl.textContent=formatTime(audioPlayer.currentTime);totalTimeEl.textContent=formatTime(audioPlayer.duration);if(progressPercent>0)progressHandle.style.display='block'}function initProgressDrag(){const progressContainer=document.querySelector('.progress-container');const progressPlayed=document.querySelector('.progress-played');const progressHandle=document.querySelector('.progress-handle');progressContainer.addEventListener('mousedown',(e)=>{isDragging=true;progressHandle.style.cursor='grabbing';updateProgressByClick(e)});document.addEventListener('mousemove',(e)=>{if(!isDragging)return;updateProgressByClick(e)});document.addEventListener('mouseup',()=>{if(isDragging){isDragging=false;progressHandle.style.cursor='grab';if(!audioPlayer.paused)audioPlayer.play()}});function updateProgressByClick(e){const containerRect=progressContainer.getBoundingClientRect();let progressPercent=(e.clientX-containerRect.left)/containerRect.width;progressPercent=Math.max(0,Math.min(1,progressPercent));progressPlayed.style.width=`${progressPercent*100}%`;progressHandle.style.left=`${progressPercent*100}%`;audioPlayer.currentTime=progressPercent*audioPlayer.duration;const currentTimeEl=document.querySelector('.current-time-text');currentTimeEl.textContent=formatTime(audioPlayer.currentTime)}}async function getMusicData(){try{playerContainer.innerHTML=`<div class="player-loading"><i class="fas fa-spinner fa-spin"></i>正在切换歌曲...</div>`;const response=await fetch(apiUrl);const musicData=await response.json();if(musicData.code!==200||!musicData.url){throw new Error('歌曲数据异常')}playerContainer.innerHTML=`<div class="player-content"><img src="${musicData.img}"alt="${musicData.song} 封面"class="player-cover"><div class="player-info"><div class="player-song">${musicData.song}</div><div class="player-singer">${musicData.singer}</div><div class="player-controls"><button id="play-btn"class="player-btn"><i class="fas fa-play"></i></button><button id="pause-btn"class="player-btn"style="display: none;"><i class="fas fa-pause"></i></button><button id="next-btn"class="player-btn"><i class="fas fa-step-forward"></i></button></div><div class="progress-container"><div class="progress-played"></div><div class="progress-handle"></div></div><div class="progress-time"><span class="current-time-text">0:00</span><span class="total-time-text">0:00</span></div><a href="${musicData.link}"target="_blank"class="player-link"><i class="fab fa-napster"></i>前往网易云音乐查看</a></div></div>`;audioPlayer.src=musicData.url;audioPlayer.play().then(()=>{document.getElementById('play-btn').style.display='none';document.getElementById('pause-btn').style.display='flex'}).catch(err=>{console.error('自动播放失败：',err)});initProgressDrag();document.getElementById('play-btn').addEventListener('click',()=>{audioPlayer.play();document.getElementById('play-btn').style.display='none';document.getElementById('pause-btn').style.display='flex'});document.getElementById('pause-btn').addEventListener('click',()=>{audioPlayer.pause();document.getElementById('pause-btn').style.display='none';document.getElementById('play-btn').style.display='flex'});document.getElementById('next-btn').addEventListener('click',getMusicData);audioPlayer.addEventListener('timeupdate',updateProgress);audioPlayer.addEventListener('loadedmetadata',()=>{const totalTimeEl=document.querySelector('.total-time-text');totalTimeEl.textContent=formatTime(audioPlayer.duration)});audioPlayer.addEventListener('ended',getMusicData)}catch(error){playerContainer.innerHTML=`<div class="player-loading"style="color: var(--accent-color);"><i class="fas fa-exclamation-circle"></i>歌曲加载失败：${error.message}</div>`;console.error('音乐获取失败：',error)}}getMusicData();